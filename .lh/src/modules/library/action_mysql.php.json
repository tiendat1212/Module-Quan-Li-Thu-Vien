{
    "sourceFile": "src/modules/library/action_mysql.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1770052034735,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1770052034735,
            "name": "Commit-0",
            "content": "<?php\n\n\nif (!defined('NV_MAINFILE')) {\n    exit('Stop!!!');\n}\n\n$sql_drop_module = [];\n$sql_create_module = [];\n\n// Table names\n$tb_categories = NV_PREFIXLANG . '_' . $module_data . '_categories';\n$tb_books      = NV_PREFIXLANG . '_' . $module_data . '_books';\n$tb_borrowers  = NV_PREFIXLANG . '_' . $module_data . '_borrowers';\n$tb_borrows    = NV_PREFIXLANG . '_' . $module_data . '_borrows';\n\n/**\n * DROP (uninstall)\n */\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrows . \"`\";\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrowers . \"`\";\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_books . \"`\";\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_categories . \"`\";\n\n/**\n * CREATE categories\n */\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_categories . \"` (\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n  `name` VARCHAR(255) NOT NULL DEFAULT '',\n  PRIMARY KEY (`id`),\n  KEY `name` (`name`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n\n/**\n * CREATE books\n */\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_books . \"` (\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n  `cover_img` VARCHAR(255) NOT NULL DEFAULT '',\n  `title` VARCHAR(255) NOT NULL DEFAULT '',\n  `author` VARCHAR(255) NOT NULL DEFAULT '',\n  `category_id` INT UNSIGNED NOT NULL DEFAULT 0,\n  `description` TEXT NULL,\n  `quantity` INT UNSIGNED NOT NULL DEFAULT 0,\n  `created_at` DATETIME NOT NULL,\n  PRIMARY KEY (`id`),\n  KEY `category_id` (`category_id`),\n  KEY `title` (`title`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n\n/**\n * CREATE borrowers\n */\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrowers . \"` (\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n  `name` VARCHAR(255) NOT NULL DEFAULT '',\n  `phone` VARCHAR(50) NOT NULL DEFAULT '',\n  `email` VARCHAR(255) NOT NULL DEFAULT '',\n  `id_card` VARCHAR(50) NOT NULL DEFAULT '',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uniq_id_card` (`id_card`),\n  KEY `email` (`email`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n\n/**\n * CREATE borrows\n * 0=borrowed, 1=returned, 2=lost, 3=cancel \n */\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrows . \"` (\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n  `book_id` INT UNSIGNED NOT NULL DEFAULT 0,\n  `borrower_id` INT UNSIGNED NOT NULL DEFAULT 0,\n  `borrow_date` DATETIME NOT NULL,\n  `return_date` DATETIME NULL,\n  `status` TINYINT UNSIGNED NOT NULL DEFAULT 0,\n  PRIMARY KEY (`id`),\n  KEY `book_id` (`book_id`),\n  KEY `borrower_id` (`borrower_id`),\n  KEY `status` (`status`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n\n/**\n * SAMPLE DATA\n */\n$sql_create_module[] = \"INSERT INTO `\" . $tb_categories . \"` (`name`) VALUES\n('Khoa học'), ('Văn học'), ('Công nghệ');\";\n\n$sql_create_module[] = \"INSERT INTO `\" . $tb_books . \"`\n(`cover_img`, `title`, `author`, `category_id`, `description`, `quantity`, `created_at`)\nVALUES\n('', 'Dế Mèn Phiêu Lưu Ký', 'Tô Hoài', 2, 'Tác phẩm văn học thiếu nhi.', 5, NOW()),\n('', 'Vũ trụ', 'Carl Sagan', 1, 'Sách khoa học phổ thông.', 10, NOW()),\n('', 'PHP căn bản', 'Nhóm tác giả', 3, 'Giới thiệu PHP cơ bản.', 7, NOW());\";\n\n$sql_create_module[] = \"INSERT INTO `\" . $tb_borrowers . \"`\n(`name`, `phone`, `email`, `id_card`)\nVALUES\n('Nguyễn Văn A', '0900000001', 'a@example.com', 'ID001'),\n('Trần Thị B', '0900000002', 'b@example.com', 'ID002');\";\n\n$sql_create_module[] = \"INSERT INTO `\" . $tb_borrows . \"`\n(`book_id`, `borrower_id`, `borrow_date`, `return_date`, `status`)\nVALUES\n(1, 1, NOW(), NULL, 0);\";\n"
        }
    ]
}