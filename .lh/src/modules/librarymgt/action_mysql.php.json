{
    "sourceFile": "src/modules/librarymgt/action_mysql.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1770046580561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770083884118,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,105 +1,112 @@\n-<?php\r\n-\r\n-\r\n-if (!defined('NV_MAINFILE')) {\r\n-    exit('Stop!!!');\r\n-}\r\n-\r\n-$sql_drop_module = [];\r\n-$sql_create_module = [];\r\n-\r\n-// Table names\r\n-$tb_categories = NV_PREFIXLANG . '_' . $module_data . '_categories';\r\n-$tb_books      = NV_PREFIXLANG . '_' . $module_data . '_books';\r\n-$tb_borrowers  = NV_PREFIXLANG . '_' . $module_data . '_borrowers';\r\n-$tb_borrows    = NV_PREFIXLANG . '_' . $module_data . '_borrows';\r\n-\r\n-/**\r\n- * DROP (uninstall)\r\n- */\r\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrows . \"`\";\r\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrowers . \"`\";\r\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_books . \"`\";\r\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_categories . \"`\";\r\n-\r\n-/**\r\n- * CREATE categories\r\n- */\r\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_categories . \"` (\r\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n-  `name` VARCHAR(255) NOT NULL DEFAULT '',\r\n-  PRIMARY KEY (`id`),\r\n-  KEY `name` (`name`)\r\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n-\r\n-/**\r\n- * CREATE books\r\n- */\r\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_books . \"` (\r\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n-  `cover_img` VARCHAR(255) NOT NULL DEFAULT '',\r\n-  `title` VARCHAR(255) NOT NULL DEFAULT '',\r\n-  `author` VARCHAR(255) NOT NULL DEFAULT '',\r\n-  `category_id` INT UNSIGNED NOT NULL DEFAULT 0,\r\n-  `description` TEXT NULL,\r\n-  `quantity` INT UNSIGNED NOT NULL DEFAULT 0,\r\n-  `created_at` DATETIME NOT NULL,\r\n-  PRIMARY KEY (`id`),\r\n-  KEY `category_id` (`category_id`),\r\n-  KEY `title` (`title`)\r\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n-\r\n-/**\r\n- * CREATE borrowers\r\n- */\r\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrowers . \"` (\r\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n-  `name` VARCHAR(255) NOT NULL DEFAULT '',\r\n-  `phone` VARCHAR(50) NOT NULL DEFAULT '',\r\n-  `email` VARCHAR(255) NOT NULL DEFAULT '',\r\n-  `id_card` VARCHAR(50) NOT NULL DEFAULT '',\r\n-  PRIMARY KEY (`id`),\r\n-  UNIQUE KEY `uniq_id_card` (`id_card`),\r\n-  KEY `email` (`email`)\r\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n-\r\n-/**\r\n- * CREATE borrows\r\n- * 0=borrowed, 1=returned, 2=lost, 3=cancel \r\n- */\r\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrows . \"` (\r\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n-  `book_id` INT UNSIGNED NOT NULL DEFAULT 0,\r\n-  `borrower_id` INT UNSIGNED NOT NULL DEFAULT 0,\r\n-  `borrow_date` DATETIME NOT NULL,\r\n-  `return_date` DATETIME NULL,\r\n-  `status` TINYINT UNSIGNED NOT NULL DEFAULT 0,\r\n-  PRIMARY KEY (`id`),\r\n-  KEY `book_id` (`book_id`),\r\n-  KEY `borrower_id` (`borrower_id`),\r\n-  KEY `status` (`status`)\r\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n-\r\n-/**\r\n- * SAMPLE DATA\r\n- */\r\n-$sql_create_module[] = \"INSERT INTO `\" . $tb_categories . \"` (`name`) VALUES\r\n-('Khoa học'), ('Văn học'), ('Công nghệ');\";\r\n-\r\n-$sql_create_module[] = \"INSERT INTO `\" . $tb_books . \"`\r\n-(`cover_img`, `title`, `author`, `category_id`, `description`, `quantity`, `created_at`)\r\n-VALUES\r\n-('', 'Dế Mèn Phiêu Lưu Ký', 'Tô Hoài', 2, 'Tác phẩm văn học thiếu nhi.', 5, NOW()),\r\n-('', 'Vũ trụ', 'Carl Sagan', 1, 'Sách khoa học phổ thông.', 10, NOW()),\r\n-('', 'PHP căn bản', 'Nhóm tác giả', 3, 'Giới thiệu PHP cơ bản.', 7, NOW());\";\r\n-\r\n-$sql_create_module[] = \"INSERT INTO `\" . $tb_borrowers . \"`\r\n-(`name`, `phone`, `email`, `id_card`)\r\n-VALUES\r\n-('Nguyễn Văn A', '0900000001', 'a@example.com', 'ID001'),\r\n-('Trần Thị B', '0900000002', 'b@example.com', 'ID002');\";\r\n-\r\n-$sql_create_module[] = \"INSERT INTO `\" . $tb_borrows . \"`\r\n-(`book_id`, `borrower_id`, `borrow_date`, `return_date`, `status`)\r\n-VALUES\r\n-(1, 1, NOW(), NULL, 0);\";\r\n+<?php\n+\n+\n+if (!defined('NV_MAINFILE')) {\n+    exit('Stop!!!');\n+}\n+\n+$sql_drop_module = [];\n+$sql_create_module = [];\n+\n+\n+\n+$sql_drop_module[] = 'DROP TABLE IF EXISTS ' . $db_config['prefix'] . '_' . $lang . '_' . $module_data;\n+$sql_drop_module[] = 'DROP TABLE IF EXISTS ' . $db_config['prefix'] . '_' . $lang . '_' . $module_data . '_rows';\n+$sql_drop_module[] = 'DROP TABLE IF EXISTS ' . $db_config['prefix'] . '_' . $lang . '_' . $module_data . '_listtype';\n+\n+$sql_create_module = $sql_drop_module;\n+// Table names\n+$tb_categories = NV_PREFIXLANG . '_' . $module_data . '_categories';\n+$tb_books      = NV_PREFIXLANG . '_' . $module_data . '_books';\n+$tb_borrowers  = NV_PREFIXLANG . '_' . $module_data . '_borrowers';\n+$tb_borrows    = NV_PREFIXLANG . '_' . $module_data . '_borrows';\n+\n+/**\n+ * DROP (uninstall)\n+ */\n+$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrows . \"`\";\n+$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrowers . \"`\";\n+$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_books . \"`\";\n+$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_categories . \"`\";\n+\n+/**\n+ * CREATE categories\n+ */\n+$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_categories . \"` (\n+  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n+  `name` VARCHAR(255) NOT NULL DEFAULT '',\n+  PRIMARY KEY (`id`),\n+  KEY `name` (`name`)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+\n+/**\n+ * CREATE books\n+ */\n+$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_books . \"` (\n+  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n+  `cover_img` VARCHAR(255) NOT NULL DEFAULT '',\n+  `title` VARCHAR(255) NOT NULL DEFAULT '',\n+  `author` VARCHAR(255) NOT NULL DEFAULT '',\n+  `category_id` INT UNSIGNED NOT NULL DEFAULT 0,\n+  `description` TEXT NULL,\n+  `quantity` INT UNSIGNED NOT NULL DEFAULT 0,\n+  `created_at` DATETIME NOT NULL,\n+  PRIMARY KEY (`id`),\n+  KEY `category_id` (`category_id`),\n+  KEY `title` (`title`)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+\n+/**\n+ * CREATE borrowers\n+ */\n+$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrowers . \"` (\n+  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n+  `name` VARCHAR(255) NOT NULL DEFAULT '',\n+  `phone` VARCHAR(50) NOT NULL DEFAULT '',\n+  `email` VARCHAR(255) NOT NULL DEFAULT '',\n+  `id_card` VARCHAR(50) NOT NULL DEFAULT '',\n+  PRIMARY KEY (`id`),\n+  UNIQUE KEY `uniq_id_card` (`id_card`),\n+  KEY `email` (`email`)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+\n+/**\n+ * CREATE borrows\n+ * 0=borrowed, 1=returned, 2=lost, 3=cancel \n+ */\n+$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrows . \"` (\n+  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n+  `book_id` INT UNSIGNED NOT NULL DEFAULT 0,\n+  `borrower_id` INT UNSIGNED NOT NULL DEFAULT 0,\n+  `borrow_date` DATETIME NOT NULL,\n+  `return_date` DATETIME NULL,\n+  `status` TINYINT UNSIGNED NOT NULL DEFAULT 0,\n+  PRIMARY KEY (`id`),\n+  KEY `book_id` (`book_id`),\n+  KEY `borrower_id` (`borrower_id`),\n+  KEY `status` (`status`)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+\n+/**\n+ * SAMPLE DATA\n+ */\n+$sql_create_module[] = \"INSERT INTO `\" . $tb_categories . \"` (`name`) VALUES\n+('Khoa học'), ('Văn học'), ('Công nghệ');\";\n+\n+$sql_create_module[] = \"INSERT INTO `\" . $tb_books . \"`\n+(`cover_img`, `title`, `author`, `category_id`, `description`, `quantity`, `created_at`)\n+VALUES\n+('', 'Dế Mèn Phiêu Lưu Ký', 'Tô Hoài', 2, 'Tác phẩm văn học thiếu nhi.', 5, NOW()),\n+('', 'Vũ trụ', 'Carl Sagan', 1, 'Sách khoa học phổ thông.', 10, NOW()),\n+('', 'PHP căn bản', 'Nhóm tác giả', 3, 'Giới thiệu PHP cơ bản.', 7, NOW());\";\n+\n+$sql_create_module[] = \"INSERT INTO `\" . $tb_borrowers . \"`\n+(`name`, `phone`, `email`, `id_card`)\n+VALUES\n+('Nguyễn Văn A', '0900000001', 'a@example.com', 'ID001'),\n+('Trần Thị B', '0900000002', 'b@example.com', 'ID002');\";\n+\n+$sql_create_module[] = \"INSERT INTO `\" . $tb_borrows . \"`\n+(`book_id`, `borrower_id`, `borrow_date`, `return_date`, `status`)\n+VALUES\n+(1, 1, NOW(), NULL, 0);\";\n"
                },
                {
                    "date": 1770111348441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,105 +8,78 @@\n $sql_drop_module = [];\n $sql_create_module = [];\n \n \n-\n $sql_drop_module[] = 'DROP TABLE IF EXISTS ' . $db_config['prefix'] . '_' . $lang . '_' . $module_data;\n $sql_drop_module[] = 'DROP TABLE IF EXISTS ' . $db_config['prefix'] . '_' . $lang . '_' . $module_data . '_rows';\n $sql_drop_module[] = 'DROP TABLE IF EXISTS ' . $db_config['prefix'] . '_' . $lang . '_' . $module_data . '_listtype';\n \n $sql_create_module = $sql_drop_module;\n-// Table names\n-$tb_categories = NV_PREFIXLANG . '_' . $module_data . '_categories';\n-$tb_books      = NV_PREFIXLANG . '_' . $module_data . '_books';\n-$tb_borrowers  = NV_PREFIXLANG . '_' . $module_data . '_borrowers';\n-$tb_borrows    = NV_PREFIXLANG . '_' . $module_data . '_borrows';\n+// Categories\n+$sql_drop_module[] = 'DROP TABLE IF EXISTS ' . NV_PREFIXLANG . '_' . $module_data . '_categories';\n \n-/**\n- * DROP (uninstall)\n- */\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrows . \"`\";\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrowers . \"`\";\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_books . \"`\";\n-$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_categories . \"`\";\n+$sql_create_module[] = 'CREATE TABLE ' . NV_PREFIXLANG . '_' . $module_data . \"_categories (\n+  id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,\n+  title VARCHAR(255) NOT NULL,\n+  alias VARCHAR(255) NOT NULL DEFAULT '',\n+  description TEXT NULL,\n+  weight SMALLINT(5) UNSIGNED NOT NULL DEFAULT 0,\n+  status TINYINT(3) UNSIGNED NOT NULL DEFAULT 1,\n+  add_time INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  edit_time INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  PRIMARY KEY (id),\n+  UNIQUE KEY uk_alias (alias),\n+  KEY idx_status (status),\n+  KEY idx_weight (weight)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\";\n \n-/**\n- * CREATE categories\n- */\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_categories . \"` (\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n-  `name` VARCHAR(255) NOT NULL DEFAULT '',\n-  PRIMARY KEY (`id`),\n-  KEY `name` (`name`)\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+// Books\n+$sql_drop_module[] = 'DROP TABLE IF EXISTS ' . NV_PREFIXLANG . '_' . $module_data . '_books';\n \n-/**\n- * CREATE books\n- */\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_books . \"` (\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n-  `cover_img` VARCHAR(255) NOT NULL DEFAULT '',\n-  `title` VARCHAR(255) NOT NULL DEFAULT '',\n-  `author` VARCHAR(255) NOT NULL DEFAULT '',\n-  `category_id` INT UNSIGNED NOT NULL DEFAULT 0,\n-  `description` TEXT NULL,\n-  `quantity` INT UNSIGNED NOT NULL DEFAULT 0,\n-  `created_at` DATETIME NOT NULL,\n-  PRIMARY KEY (`id`),\n-  KEY `category_id` (`category_id`),\n-  KEY `title` (`title`)\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+$sql_create_module[] = 'CREATE TABLE ' . NV_PREFIXLANG . '_' . $module_data . \"_books (\n+  id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,\n+  cat_id INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  title VARCHAR(255) NOT NULL,\n+  alias VARCHAR(255) NOT NULL DEFAULT '',\n+  author VARCHAR(255) NOT NULL DEFAULT '',\n+  publisher VARCHAR(255) NOT NULL DEFAULT '',\n+  publish_year SMALLINT(5) UNSIGNED NOT NULL DEFAULT 0,\n+  isbn VARCHAR(50) NOT NULL DEFAULT '',\n+  quantity INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  description MEDIUMTEXT NULL,\n+  image VARCHAR(255) NOT NULL DEFAULT '',\n+  status TINYINT(3) UNSIGNED NOT NULL DEFAULT 1,\n+  add_time INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  edit_time INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  PRIMARY KEY (id),\n+  UNIQUE KEY uk_alias (alias),\n+  KEY idx_cat (cat_id),\n+  KEY idx_status (status),\n+  KEY idx_quantity (quantity)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\";\n \n-/**\n- * CREATE borrowers\n- */\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrowers . \"` (\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n-  `name` VARCHAR(255) NOT NULL DEFAULT '',\n-  `phone` VARCHAR(50) NOT NULL DEFAULT '',\n-  `email` VARCHAR(255) NOT NULL DEFAULT '',\n-  `id_card` VARCHAR(50) NOT NULL DEFAULT '',\n-  PRIMARY KEY (`id`),\n-  UNIQUE KEY `uniq_id_card` (`id_card`),\n-  KEY `email` (`email`)\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+// Borrows (use system user_id)\n+$sql_drop_module[] = 'DROP TABLE IF EXISTS ' . NV_PREFIXLANG . '_' . $module_data . '_borrows';\n \n-/**\n- * CREATE borrows\n- * 0=borrowed, 1=returned, 2=lost, 3=cancel \n- */\n-$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrows . \"` (\n-  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\n-  `book_id` INT UNSIGNED NOT NULL DEFAULT 0,\n-  `borrower_id` INT UNSIGNED NOT NULL DEFAULT 0,\n-  `borrow_date` DATETIME NOT NULL,\n-  `return_date` DATETIME NULL,\n-  `status` TINYINT UNSIGNED NOT NULL DEFAULT 0,\n-  PRIMARY KEY (`id`),\n-  KEY `book_id` (`book_id`),\n-  KEY `borrower_id` (`borrower_id`),\n-  KEY `status` (`status`)\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n+$sql_create_module[] = 'CREATE TABLE ' . NV_PREFIXLANG . '_' . $module_data . \"_borrows (\n+  id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,\n+  book_id INT(10) UNSIGNED NOT NULL DEFAULT 0,\n+  user_id INT(10) UNSIGNED NOT NULL DEFAULT 0,\n \n-/**\n- * SAMPLE DATA\n- */\n-$sql_create_module[] = \"INSERT INTO `\" . $tb_categories . \"` (`name`) VALUES\n-('Khoa học'), ('Văn học'), ('Công nghệ');\";\n+  request_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\n+  approve_date DATETIME NULL,\n+  borrow_date DATETIME NULL,\n+  due_date DATETIME NULL,\n+  return_date DATETIME NULL,\n \n-$sql_create_module[] = \"INSERT INTO `\" . $tb_books . \"`\n-(`cover_img`, `title`, `author`, `category_id`, `description`, `quantity`, `created_at`)\n-VALUES\n-('', 'Dế Mèn Phiêu Lưu Ký', 'Tô Hoài', 2, 'Tác phẩm văn học thiếu nhi.', 5, NOW()),\n-('', 'Vũ trụ', 'Carl Sagan', 1, 'Sách khoa học phổ thông.', 10, NOW()),\n-('', 'PHP căn bản', 'Nhóm tác giả', 3, 'Giới thiệu PHP cơ bản.', 7, NOW());\";\n+  status TINYINT(3) UNSIGNED NOT NULL DEFAULT 0,\n+  note_user VARCHAR(255) NOT NULL DEFAULT '',\n+  note_admin VARCHAR(255) NOT NULL DEFAULT '',\n \n-$sql_create_module[] = \"INSERT INTO `\" . $tb_borrowers . \"`\n-(`name`, `phone`, `email`, `id_card`)\n-VALUES\n-('Nguyễn Văn A', '0900000001', 'a@example.com', 'ID001'),\n-('Trần Thị B', '0900000002', 'b@example.com', 'ID002');\";\n-\n-$sql_create_module[] = \"INSERT INTO `\" . $tb_borrows . \"`\n-(`book_id`, `borrower_id`, `borrow_date`, `return_date`, `status`)\n-VALUES\n-(1, 1, NOW(), NULL, 0);\";\n+  PRIMARY KEY (id),\n+  KEY idx_book (book_id),\n+  KEY idx_user (user_id),\n+  KEY idx_status (status),\n+  KEY idx_due (due_date),\n+  KEY idx_user_status (user_id, status),\n+  KEY idx_status_due (status, due_date)\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\";\n\\ No newline at end of file\n"
                }
            ],
            "date": 1770046580561,
            "name": "Commit-0",
            "content": "<?php\r\n\r\n\r\nif (!defined('NV_MAINFILE')) {\r\n    exit('Stop!!!');\r\n}\r\n\r\n$sql_drop_module = [];\r\n$sql_create_module = [];\r\n\r\n// Table names\r\n$tb_categories = NV_PREFIXLANG . '_' . $module_data . '_categories';\r\n$tb_books      = NV_PREFIXLANG . '_' . $module_data . '_books';\r\n$tb_borrowers  = NV_PREFIXLANG . '_' . $module_data . '_borrowers';\r\n$tb_borrows    = NV_PREFIXLANG . '_' . $module_data . '_borrows';\r\n\r\n/**\r\n * DROP (uninstall)\r\n */\r\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrows . \"`\";\r\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_borrowers . \"`\";\r\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_books . \"`\";\r\n$sql_drop_module[] = \"DROP TABLE IF EXISTS `\" . $tb_categories . \"`\";\r\n\r\n/**\r\n * CREATE categories\r\n */\r\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_categories . \"` (\r\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n  `name` VARCHAR(255) NOT NULL DEFAULT '',\r\n  PRIMARY KEY (`id`),\r\n  KEY `name` (`name`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n\r\n/**\r\n * CREATE books\r\n */\r\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_books . \"` (\r\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n  `cover_img` VARCHAR(255) NOT NULL DEFAULT '',\r\n  `title` VARCHAR(255) NOT NULL DEFAULT '',\r\n  `author` VARCHAR(255) NOT NULL DEFAULT '',\r\n  `category_id` INT UNSIGNED NOT NULL DEFAULT 0,\r\n  `description` TEXT NULL,\r\n  `quantity` INT UNSIGNED NOT NULL DEFAULT 0,\r\n  `created_at` DATETIME NOT NULL,\r\n  PRIMARY KEY (`id`),\r\n  KEY `category_id` (`category_id`),\r\n  KEY `title` (`title`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n\r\n/**\r\n * CREATE borrowers\r\n */\r\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrowers . \"` (\r\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n  `name` VARCHAR(255) NOT NULL DEFAULT '',\r\n  `phone` VARCHAR(50) NOT NULL DEFAULT '',\r\n  `email` VARCHAR(255) NOT NULL DEFAULT '',\r\n  `id_card` VARCHAR(50) NOT NULL DEFAULT '',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `uniq_id_card` (`id_card`),\r\n  KEY `email` (`email`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n\r\n/**\r\n * CREATE borrows\r\n * 0=borrowed, 1=returned, 2=lost, 3=cancel \r\n */\r\n$sql_create_module[] = \"CREATE TABLE IF NOT EXISTS `\" . $tb_borrows . \"` (\r\n  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,\r\n  `book_id` INT UNSIGNED NOT NULL DEFAULT 0,\r\n  `borrower_id` INT UNSIGNED NOT NULL DEFAULT 0,\r\n  `borrow_date` DATETIME NOT NULL,\r\n  `return_date` DATETIME NULL,\r\n  `status` TINYINT UNSIGNED NOT NULL DEFAULT 0,\r\n  PRIMARY KEY (`id`),\r\n  KEY `book_id` (`book_id`),\r\n  KEY `borrower_id` (`borrower_id`),\r\n  KEY `status` (`status`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\r\n\r\n/**\r\n * SAMPLE DATA\r\n */\r\n$sql_create_module[] = \"INSERT INTO `\" . $tb_categories . \"` (`name`) VALUES\r\n('Khoa học'), ('Văn học'), ('Công nghệ');\";\r\n\r\n$sql_create_module[] = \"INSERT INTO `\" . $tb_books . \"`\r\n(`cover_img`, `title`, `author`, `category_id`, `description`, `quantity`, `created_at`)\r\nVALUES\r\n('', 'Dế Mèn Phiêu Lưu Ký', 'Tô Hoài', 2, 'Tác phẩm văn học thiếu nhi.', 5, NOW()),\r\n('', 'Vũ trụ', 'Carl Sagan', 1, 'Sách khoa học phổ thông.', 10, NOW()),\r\n('', 'PHP căn bản', 'Nhóm tác giả', 3, 'Giới thiệu PHP cơ bản.', 7, NOW());\";\r\n\r\n$sql_create_module[] = \"INSERT INTO `\" . $tb_borrowers . \"`\r\n(`name`, `phone`, `email`, `id_card`)\r\nVALUES\r\n('Nguyễn Văn A', '0900000001', 'a@example.com', 'ID001'),\r\n('Trần Thị B', '0900000002', 'b@example.com', 'ID002');\";\r\n\r\n$sql_create_module[] = \"INSERT INTO `\" . $tb_borrows . \"`\r\n(`book_id`, `borrower_id`, `borrow_date`, `return_date`, `status`)\r\nVALUES\r\n(1, 1, NOW(), NULL, 0);\";\r\n"
        }
    ]
}